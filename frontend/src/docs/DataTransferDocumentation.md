# Документация по передаче данных между модулями

## Обзор

В приложении Moskvitz 3D реализована система передачи данных между модулями через общий контекст данных. Это позволяет различным частям приложения обмениваться информацией, такой как измерения, файлы пациентов и 3D модели.

## Архитектура

### Контекст данных (DataContext)

Центральным элементом системы передачи данных является `DataContext`, который предоставляет:

1. **Хранилище общих данных** - централизованное хранилище для всех данных, доступных между модулями
2. **Функции управления данными** - методы для добавления, получения и передачи данных
3. **Персистентность** - автоматическое сохранение данных в localStorage

### Основные компоненты

#### 1. DataProvider
Обертка для приложения, которая предоставляет контекст данных всем дочерним компонентам.

#### 2. useData Hook
Хук для доступа к функциям контекста данных из компонентов.

## Типы передаваемых данных

### 1. Файлы пациентов
- Изображения (фотометрия, цефалометрия)
- Медицинские документы (КТ, рентген)

### 2. Измерения
- Цефалометрические данные
- Фотометрические измерения

### 3. 3D модели
- Стоматологические модели
- Окклюзионные накладки
- Планы лечения

## Реализация передачи данных

### 1. Добавление данных

```javascript
import { useData } from '../contexts/DataContext';

const { addPatientFile, addMeasurements, addModel } = useData();

// Добавление файла пациента
await addPatientFile(file, patientId, description);

// Добавление измерений
addMeasurements('cephalometry', measurements);

// Добавление 3D модели
addModel('dental-cast', modelData);
```

### 2. Передача данных между модулями

```javascript
import { useData } from '../contexts/DataContext';

const { transferData, getTransferredData } = useData();

// Отправка данных из модуля A в модуль B
transferData('module-a', 'module-b', {
  patientId: 123,
  measurements: cephalometryData,
  files: patientFiles
});

// Получение данных в модуле B
const receivedData = getTransferredData('module-b');
if (receivedData) {
  // Обработка полученных данных
  console.log('Received data from', receivedData.sourceModule);
}
```

### 3. Пример использования в модуле цефалометрии

```javascript
import React from 'react';
import { useData } from '../contexts/DataContext';

const CephalometryModule = () => {
  const { addMeasurements, transferData } = useData();
  
  const handleSave = () => {
    // Сохраняем измерения
    addMeasurements('cephalometry', measurements);
    
    // Данные модуля цефалометрии сохранены
  };
  
  // ...
};
```

## Практические примеры

### 1. Сохранение цефалометрических данных

Когда пользователь завершает анализ в модуле цефалометрии, данные сохраняются для дальнейшего использования.

### 2. Совместное использование изображений

Фотографии, загруженные в модуле фотометрии, становятся доступны в других модулях для комплексного анализа.


## Преимущества реализации

1. **Гибкость** - модули могут обмениваться данными без жесткой связи
2. **Масштабируемость** - легко добавлять новые типы данных и модули
3. **Надежность** - данные сохраняются между сессиями
4. **Прозрачность** - четкий механизм отслеживания источника данных

## Рекомендации по использованию

1. **Используйте семантические имена модулей** для лучшей читаемости кода
2. **Очищайте переданные данные** после использования, если это необходимо
3. **Обрабатывайте ошибки** при передаче данных
4. **Документируйте** структуру передаваемых данных

## Будущие улучшения

1. **Синхронизация с сервером** - автоматическая синхронизация данных с бэкендом
2. **Уведомления** - система уведомлений о новых данных для модулей
3. **Валидация данных** - проверка структуры и типа передаваемых данных
4. **История передач** - журнал всех операций передачи данных