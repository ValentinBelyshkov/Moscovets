# PatientCard - Рефакторинг

## Обзор

PatientCard был рефакторинг с интеграцией логики из MedicalCard. Все функциональные возможности теперь сосредоточены в PatientCard.

## Структура файлов

```
frontend/src/components/patientcard/
├── PatientCardConstants.js          # Константы и конфигурация
├── PatientCardRefactored.js         # Главный компонент
├── usePatientCardState.js           # Управление состоянием
├── usePatientCardHandlers.js        # Обработчики событий и загрузка данных
├── usePatientCardDataIntegration.js # Интеграция данных из модулей
└── usePatientCardDataTransformers.js # Преобразование данных для отображения
```

## Основные изменения

### Из MedicalCard в PatientCard

Перенесена следующая логика:
- Загрузка данных из модулей (фотометрия, биометрия, цефалометрия, моделирование, КТ)
- Интеграция данных из localStorage и DataContext
- Создание интегрированной структуры медицинских данных
- Управление изображениями и моделями из разных модулей

### Сохранение дизайна PatientCard

Дизайн PatientCard полностью сохранен:
- Верхняя панель с навигацией
- Карточка пациента с фото и основной информацией
- Вкладки модулей (Обзор, Фотометрия, Цефалометрия, Биометрия, 3D Модели, КТ, История)
- Секция статистики
- Кнопки действий для навигации

## Использование

```javascript
import PatientCard from './components/PatientCard';

<PatientCard patient={patientData} onBack={handleBack} />
```

Или через маршрут:

```javascript
<Route path="/patients/:id" element={<PatientCard />} />
```

## Хуки

### usePatientCardState

Управляет состоянием компонента:
- Данные пациента
- Статус загрузки
- Активная вкладка
- Данные модулей
- История болезни
- Изображения и модели

### usePatientCardHandlers

Обработчики для загрузки данных:
- `loadPhotometryData(patientId)` - загрузка фотометрии
- `loadBiometryData(patientId)` - загрузка биометрии
- `loadCephalometryData(patientId)` - загрузка цефалометрии
- `loadModelingData(patientId)` - загрузка 3D моделей
- `loadCTData(patientId)` - загрузка КТ снимков
- `loadMedicalHistory(patientId)` - загрузка истории болезни

Данные загружаются из:
1. DataContext (самые актуальные)
2. localStorage (хранилище данных модулей)
3. medical_card (интегрированные данные)

### usePatientCardDataIntegration

Интеграция данных из всех модулей в единую структуру:
- Персональные данные
- Анамнез
- Фотометрический анализ
- Внутриротовой анализ
- Антропометрия/Биометрия
- Цефалометрический анализ
- КТ анализ
- 3D моделирование
- Диагнозы
- План лечения
- Выводы

### usePatientCardDataTransformers

Преобразование данных для отображения:
- Извлечение изображений из данных модулей
- Преобразование данных модулей в структуру для карточек
- Группировка истории болезни по датам
- Сортировка дат

## Статусы загрузки

Каждый модуль имеет свой статус загрузки:
- `photoDataLoaded` - фотометрия
- `biometryDataLoaded` - биометрия
- `cephalometryDataLoaded` - цефалометрия
- `modelingDataLoaded` - 3D модели

## Интегрированные данные

PatientCard создает интегрированную структуру данных, которая включает:
- Данные из реальных модулей (если доступны)
- Демонстрационные данные (если реальные данные отсутствуют)
- Структурированную информацию для всех разделов медицинской карты

## Навигация

- `/patients/:id` - просмотр карточки пациента по ID
- `/medical-card/:id` - альтернативный маршрут (перенаправляет на PatientCard)

## Обратная совместимость

Файл `MedicalCard.js` переэкспортирует из `PatientCard` для обратной совместимости.

## Удаленные файлы

Папка `medicalcard/` была переименована в `medicalcard_old/` для архивирования.

## Следующие шаги

1. После успешного тестирования можно удалить папку `medicalcard_old/`
2. Убедиться, что все маршруты используют PatientCard
3. Проверить, что все функциональные возможности работают корректно
