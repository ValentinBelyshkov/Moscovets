# Миграция MedicalCard в PatientCard

## Что было сделано

### 1. Создана новая структура PatientCard
Все файлы созданы в `frontend/src/components/patientcard/`:
- `PatientCardConstants.js` - константы вкладок и модулей
- `PatientCardRefactored.js` - главный компонент с интегрированной логикой
- `usePatientCardState.js` - управление состоянием
- `usePatientCardHandlers.js` - загрузка данных из модулей
- `usePatientCardDataIntegration.js` - интеграция данных
- `usePatientCardDataTransformers.js` - трансформация данных
- `README.md` - документация

### 2. Логика MedicalCard полностью перенесена
Перенесены все ключевые функции:
- Загрузка данных из DataContext (самые актуальные данные)
- Загрузка данных из localStorage (сохраненные данные модулей)
- Интегрированная структура медицинских данных
- Управление изображениями и моделями из всех модулей
- История болезни пациента
- Статусы загрузки для каждого модуля

### 3. Дизайн PatientCard полностью сохранен
Весь оригинальный дизайн PatientCard сохранен без изменений:
- Верхняя панель с кнопкой "Назад"
- Карточка пациента с аватаром, информацией и жалобами
- Секция статистики (исследования, записи, визиты)
- Секция фотографий пациента
- Вкладки модулей (Обзор, Фотометрия, Цефалометрия, Биометрия, 3D Модели, КТ, История)
- Карточки модулей с данными и измерениями
- Детальные результаты анализа
- Секция истории болезни с группировкой по датам
- Кнопки действий для навигации к модулям

### 4. Обновлены импорты и маршруты
- `MedicalCard.js` - теперь переэкспортирует из `PatientCard` для обратной совместимости
- `PatientCard.js` - обновлен для экспорта нового рефакторингового компонента
- `App.js` - удален импорт `MedicalCard`, используется только `PatientCard`
- Папка `medicalcard/` переименована в `medicalcard_old/` для архивирования

### 5. Сохранена функциональность
- Загрузка данных пациента из API
- Загрузка данных из всех модулей (фотометрия, биометрия, цефалометрия, моделирование, КТ)
- Отображение интегрированных медицинских данных
- Навигация между модулями через hash-маршруты
- Отображение истории болезни с группировкой по датам

## Структура нового компонента

```
PatientCardRefactored (главный компонент)
├── usePatientCardState (состояние)
│   ├── Данные пациента
│   ├── Состояние вкладок
│   ├── Данные модулей
│   ├── Изображения и модели
│   └── Статусы загрузки
│
├── usePatientCardHandlers (загрузка данных)
│   ├── loadPhotometryData()
│   ├── loadBiometryData()
│   ├── loadCephalometryData()
│   ├── loadModelingData()
│   ├── loadCTData()
│   └── loadMedicalHistory()
│
├── usePatientCardDataIntegration (интеграция)
│   └── getIntegratedMedicalData()
│       ├── Персональные данные
│       ├── Анамнез
│       ├── Фотометрия
│       ├── Внутриротовой анализ
│       ├── Антропометрия
│       ├── Цефалометрия
│       ├── КТ анализ
│       ├── 3D моделирование
│       ├── Диагнозы
│       ├── План лечения
│       └── Выводы
│
└── usePatientCardDataTransformers (трансформация)
    ├── extractImagesFromModuleData()
    ├── transformModuleDataForDisplay()
    ├── groupHistoryByDate()
    └── sortDates()
```

## Как использовать

```javascript
import PatientCard from './components/PatientCard';

// С передачей пациента как пропса
<PatientCard patient={patientData} onBack={handleBack} />

// Или через маршрут (автоматическая загрузка по ID)
<Route path="/patients/:id" element={<PatientCard />} />
```

## Обратная совместимость

Для старого кода, который использовал MedicalCard:

```javascript
import MedicalCard from './components/MedicalCard';
// Этот импорт все еще работает - переэкспорт из PatientCard
```

## Данные

### Источники данных (в порядке приоритета):
1. **DataContext** - самые актуальные данные из текущей сессии
2. **localStorage** - сохраненные данные модулей
3. **medical_card** - интегрированные данные
4. **API** - данные с сервера

### Демонстрационные данные
Если реальные данные отсутствуют, используются демонстрационные данные для:
- Истории болезни
- Интегрированной структуры медицинских данных
- Статистики

## Дальнейшие действия

После успешного тестирования:
1. Можно удалить папку `medicalcard_old/`
2. Убедиться, что все маршруты работают корректно
3. Удалить переэкспорт из `MedicalCard.js` если не нужна обратная совместимость

## Проверка

Для проверки работы:
1. Запустить frontend: `cd frontend && npm start`
2. Перейти на страницу пациента: `/patients/1`
3. Проверить:
   - Загрузка данных пациента
   - Отображение вкладок модулей
   - Данные из модулей (если есть в localStorage)
   - История болезни
   - Навигация по hash-маршрутам

## Резюме

✅ Логика MedicalCard полностью перенесена в PatientCard
✅ Дизайн PatientCard полностью сохранен
✅ Все функции работают как раньше
✅ Обратная совместимость через переэкспорт
✅ Документация обновлена
✅ Структура файлов оптимизирована
